
## í‘ì…˜ ì½œë§  

### ì •ì˜  

- GPTì—ê²Œ íŠ¹ì •í•œ ê¸°ëŠ¥ì„ ê°€ì§„ í•¨ìˆ˜ì™€ ê·¸ì— ëŒ€í•œ ì„¤ëª…ì„ ì œê³µí•˜ê³ , ìƒí™©ì— ë§ê²Œ ê·¸ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ í•˜ëŠ” ë°©ë²•  
- GPTëŠ” í…ìŠ¤íŠ¸ ìƒì„± ëª¨ë¸ì´ë©°, íŠ¹ì •í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê±°ë‚˜ ì‹¤ì‹œê°„ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ì—†ë‹¤ëŠ” í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•œ ë°©ë²•  

### êµ¬ì„± ìš”ì†Œ  

#### ì•„í‚¤í…ì²˜ì  êµ¬ì„± ìš”ì†Œ  



#### ì½”ë“œì  êµ¬ì„± ìš”ì†Œ  

- ë„êµ¬ ëª©ë¡ : GPT ëª¨ë¸ì´ ì–´ë–¤ ë„êµ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” ì„¤ëª…ì„œ ì—­í• .  
- ë„êµ¬ í•¨ìˆ˜ : ì‹¤ì œë¡œ ì–´ë– í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜  

```python
# ë„êµ¬ í•¨ìˆ˜
def get_current_time():
    now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    print(now)
    return now

# ë„êµ¬ ëª©ë¡
tools = [
    {
        "type": "function",
        "function": {
            "name": "get_current_time",
            "description": "í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤."
        }
    },
    # ì¶”ê°€ë¡œ ì •ì˜ë˜ëŠ” ë„êµ¬ë“¤ì„ ì¶”ê°€í•œë‹¤.  
]
```


### í‘ì…˜ ì½œë§ ì‘ë™ ë°©ë²•  

#### OpenAI API  

- í‘ì…˜ ì½œë§ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ ëª©ë¡ì„ ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ì •ì˜í•´ë‘ê³   
- GPT API ë¥¼ í˜¸ì¶œí•  ë•Œ ì´ ë„êµ¬ ëª©ë¡ì„ í•¨ê»˜ ì œê³µí•œë‹¤.  
- GPTëŠ” ë‹µë³€ì— íŠ¹ì • ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨í•  ê²½ìš°, ì •ì˜ëœ ë„êµ¬ ëª©ë¡ì—ì„œ ê·¸ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë„êµ¬ê°€ ìˆëŠ”ì§€ ì°¾ê³   
- ë„êµ¬ê°€ ìˆë‹¤ë©´ ê·¸ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ ë‹µë³€ì„ ìˆ˜í–‰í•œë‹¤.  


### ì‹¤ìŠµ  

#### í˜„ì¬ ì‹œê°„ì„ ì•Œë ¤ì£¼ëŠ” ë„êµ¬  

> gpt api ìš”ì²­ ë“±ì˜ ë‚´ìš©ì€ ìƒëµ  

- gpt_functions.py íŒŒì¼ì˜ get_current_time í•¨ìˆ˜  

```python
# gpt_functions.py
from datetime import datetime

def get_current_time():
    now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    print(now)
    return now

tools = [
    {
        "type": "function",
        "function": {
            "name": "get_current_time",
            "description": "í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤."
        }
    },
]
```

- í„°ë¯¸ë„ì—ì„œ íˆ´ì½œë§ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì½”ë“œ

```python
# what_time_is_it_terminal.py
from tools.gpt_functions import get_current_time, tools
from openai import OpenAI
from config.config import config

client = OpenAI(api_key = config["apikey"]["openai"])

# chat gptë¡œë¶€í„° ì‘ë‹µì„ ë°›ì•„ì˜¤ëŠ” ê¸°ë³¸ì ì¸ í‹€
def get_ai_response(messages, tools=None):
    response = client.chat.completions.create(
        model = "gpt-4o",
        messages = messages,
        tools = tools
    )
    return response

# ê¸°ë³¸ ì´ˆê¸° ë©”ì‹œì§€ ì…‹
messages = [
    {"role" : "system", "content" : "ë„ˆëŠ” ì‚¬ìš©ìë¥¼ ë„ì™€ì£¼ëŠ” ìƒë‹´ì‚¬ì•¼."},
]

# í„°ë¯¸ë„ ëŒ€í™” ì„¹ì…˜
def terminal_conversation():
    while True:
        # ì‚¬ìš©ì ì…ë ¥ ë°œí™”
        user_input = input("ì‚¬ìš©ì\t:")
        if user_input == "exit":
            break
        
        # ë©”ì‹œì§€ ì…‹ì— ì‚¬ìš©ì ë°œí™” ì…ë ¥
        messages.append({"role":"user", "content":user_input})
        
        # chat gptì—ê±° ë‹µë³€ ë°›ì•„ì˜´
        ai_response = get_ai_response(messages=messages,
                                    tools=tools) # ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ ëª©ë¡ ì œê³µ
        ai_message = ai_response.choices[0].message
        print(ai_message) #---------------------------------------------------- (1)
        
        # tool_calls
        tool_calls = ai_message.tool_calls
        # gptê°€ íŠ¹ì • í•¨ìˆ˜ ì‹¤í–‰ì´ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨í•  ê²½ìš°, ì‘ë‹µì˜ tool_calls ì†ì„±ì— ì •ë³´ê°€ í¬í•¨ë¨ #TODO: ë©”ì‹œì§€ êµ¬ì¡° í™•ì¸
        if tool_calls:
            # ë„êµ¬ ì •ë³´ ì¶”ì¶œ #TODO: tool_calls ë¦¬ìŠ¤í°ìŠ¤ êµ¬ì¡° í™•ì¸
            tool_name = tool_calls[0].function.name
            tool_call_id = tool_calls[0].id #TODO: idê°€ ë¬´ìŠ¨ ì—­í• ì„ í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ìŠ¤í„°ë””ë•Œ ë°œí‘œ
            # ë„êµ¬ë§ˆë‹¤ ì‚¬ìš© í•¨ìˆ˜ ë§¤ì¹­í•´ì„œ ë„êµ¬ì˜ ê²°ê³¼ë¥¼ ë©”ì‹œì§€ë¡œ ìƒì„±
            if tool_name == "get_current_time":
                messages.append(
                    {
                        "role" : "function",
                        "tool_call_id" : tool_call_id,  # ì—¬ê¸°ì— idë¥¼ ì…ë ¥í•´ gpt ìì‹ ì´ ìš”ì²­í•œ ë„êµ¬ í˜¸ì¶œê³¼ ê²°ê³¼ë¬¼ì„ ë§¤ì¹­
                        "name" : tool_name,
                        "content" : get_current_time(), # í•¨ìˆ˜ì˜ ê²°ê³¼ë¬¼ì„ ì…ë ¥ìœ¼ë¡œ ì ì¬
                    }
                )
            # í•œë²ˆ ë” gpt ì‘ë‹µ í˜¸ì¶œ, ì´ë²ˆì—” ë„êµ¬ì˜ ê²°ê³¼ì™€ ë„êµ¬ í˜¸ì¶œ idë¥¼ í¬í•¨í•¨
            print(messages) #-------------------------------------------------- (2)
            ai_response = get_ai_response(messages, tools=tools)
            print(ai_response) #----------------------------------------------- (3)
            ai_message = ai_response.choices[0].message
            
        messages.append(ai_message)
        print("AI\t:" + ai_message.content)
```

- ëŒ€í™” ë‚´ìš©  

```bash
ì‚¬ìš©ì   :ì•ˆë…•í•˜ì„¸ìš”. ì§€ê¸ˆì€ ëª‡ì‹œì¸ê°€ìš”?
AI      :ì•ˆë…•í•˜ì„¸ìš”! ì§€ê¸ˆ ì‹œê°„ì€ 2026ë…„ 1ì›” 26ì¼ 12ì‹œ 33ë¶„ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?
```

- ìš”ì²­ ë° ì‘ë‹µ ì‚¬í•­ ëœ¯ì–´ë³´ê¸°  

```python
# (1) ìµœì´ˆ AI ì‘ë‹µ ai_message
ChatCompletionMessage(
    content=None, refusal=None, role='assistant', annotations=[], audio=None, function_call=None,
    tool_calls=[
        ChatCompletionMessageFunctionToolCall(
            id='call_AYhSDEAD2en5ek8egrkFGLE3', # Tool Call ID
            function=Function(
                arguments='{}', name='get_current_time'),
            type='function')
            ]
        )

# (2) Tool ì˜ ê²°ê³¼ë¬¼ì„ ë‹´ì€ messages
[
    {'role': 'system', 'content': 'ë„ˆëŠ” ì‚¬ìš©ìë¥¼ ë„ì™€ì£¼ëŠ” ìƒë‹´ì‚¬ì•¼.'},
    {'role': 'user', 'content': 'ì•ˆë…•í•˜ì„¸ìš”. ì§€ê¸ˆì€ ëª‡ì‹œì¸ê°€ìš”?'},
    {'role': 'function', 'tool_call_id': 'call_15...', 'name': 'get_current_time', 'content': '2026-01-26 12:36:41'}
]

# (3) ìµœì¢… ì‘ë‹µ ai_response
ChatCompletion(id='chatcmpl-D27h4yWyDUX5LU8pELCn3idll5RNN',
    choices=[
        Choice(finish_reason='stop',
               index=0,
               logprobs=None,
               message=ChatCompletionMessage(
                  content='ì•ˆë…•í•˜ì„¸ìš”! í˜„ì¬ ì‹œê°„ì€ 2026ë…„ 1ì›” 26ì¼ ì˜¤í›„ 12ì‹œ 36ë¶„ì…ë‹ˆë‹¤.',
                  refusal=None, role='assistant', annotations=[], audio=None, function_call=None, tool_calls=None
                )
              )
            ],
    created=1769398602,
    model='gpt-4o-2024-08-06',
    object='chat.completion',
    service_tier='default',
    system_fingerprint='fp_deacdd5f6f',
    usage=CompletionUsage(
        completion_tokens=26,
        prompt_tokens=78,
        total_tokens=104,
        completion_tokens_details=CompletionTokensDetails(
            accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0
        ),
        prompt_tokens_details=PromptTokensDetails(
            audio_tokens=0, cached_tokens=0
        )
    )
)
```

> - tool_calls[0].id  
> 
> tool_calls[0].id)ëŠ” **GPTê°€ ìš”ì²­í•œ íŠ¹ì • ë„êµ¬ í˜¸ì¶œê³¼, ê·¸ ë„êµ¬ì˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ 1:1ë¡œ ì—°ê²°í•˜ê¸° ìœ„í•œ ì‹ë³„ì(ID)**  
> **â€œGPTê°€ ë°©ê¸ˆ ìš”ì²­í•œ í•¨ìˆ˜ í˜¸ì¶œê³¼, ë‚´ê°€ ëŒë ¤ì¤€ ê²°ê³¼ê°€ ê°™ì€ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ì„ GPTì—ê²Œ ì•Œë ¤ì£¼ëŠ” ì—°ê²° ê³ ë¦¬â€**
> GPTëŠ” í•œ ë²ˆì˜ ì‘ë‹µì—ì„œ **ì—¬ëŸ¬ ê°œì˜ ë„êµ¬ í˜¸ì¶œ(tool_calls)**ì„ ìš”ì²­í•  ìˆ˜ ìˆê³ , ë”°ë¼ì„œ â€œì–´ë–¤ í•¨ìˆ˜ ìš”ì²­ì— ëŒ€í•œ ê²°ê³¼ì¸ì§€â€ë¥¼ ëª…í™•íˆ êµ¬ë¶„í•´ì•¼ í•œë‹¤.  
> 
```python
tool_call_id = tool_calls[0].id #TODO: idê°€ ë¬´ìŠ¨ ì—­í• ì„ í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ìŠ¤í„°ë””ë•Œ ë°œí‘œ
if tool_name == "get_current_time":
    messages.append(
        {
            "role" : "function",
            "tool_call_id" : tool_call_id,  # ì—¬ê¸°ì— idë¥¼ ì…ë ¥í•´ gpt ìì‹ ì´ ìš”ì²­í•œ ë„êµ¬ í˜¸ì¶œê³¼ ê²°ê³¼ë¬¼ì„ ë§¤ì¹­
            "name" : tool_name,
            "content" : get_current_time(),
        }
    )
```
> 

#### API í˜¸ì¶œ íšŸìˆ˜  

- ì´ë ‡ê²Œ í‘ì…˜ ì½œë§ì„ í•˜ëŠ” ê²½ìš°, API í˜¸ì¶œì˜ íšŸìˆ˜ëŠ” ì´ 2íšŒì´ë‹¤.  
- í™•ì¸ í•„ìš”  

```python
 # ë©”ì‹œì§€ ì…‹ì— ì‚¬ìš©ì ë°œí™” ì…ë ¥
messages.append({"role":"user", "content":user_input})
# chat gptì—ê±° ë‹µë³€ ë°›ì•„ì˜´
ai_response = get_ai_response(messages=messages,tools=tools) #--- 1íšŒ

...

# í‘ì…˜ì½œë§ì— ëŒ€í•œ ê²°ê³¼ê°’ì„ ë‹´ì•„ í•œ ë²ˆ ë” LLM API ìš”ì²­
if tool_name == "get_current_time":
    messages.append(
        {
            "role" : "function",
            "tool_call_id" : tool_call_id,
            "name" : tool_name,
            "content" : get_current_time(),
        }
    )
ai_response = get_ai_response(messages, tools=tools) #---------- 2íšŒ
```

#### ë„ì‹œë³„ ì‹œê°„ ì•Œë ¤ ì£¼ê¸°  

- ì±…ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´, get_current_time() í•¨ìˆ˜ë§Œìœ¼ë¡œëŠ” ë‹¤ë¥¸ ë„ì‹œì˜ ì‹œê°„ì„ ì•„ëŠ” ê²Œ ì–´ë µë‹¤ê³  ì˜ˆì‹œë¥¼ ë“¤ì—ˆë‹¤.  
- LLM ëª¨ë¸ì´ get_current_time() ì˜ ê²°ê³¼ë¬¼ ì‹œê°„ì„ UTC ê¸°ì¤€ìœ¼ë¡œ ì•Œì•„ë“£ê¸° ë•Œë¬¸ì´ë¼ê³ .  

```bash
ì‚¬ìš©ì: ì§€ê¸ˆ ë‰´ìš•ì€ ëª‡ ì‹œì•¼?
2025-01-06 19:09:24
AI: í˜„ì¬ UTC ì‹œê°„ì€ 2025ë…„ 1ì›” 6ì¼ 19ì‹œ 9ë¶„ 24ì´ˆ ì…ë‹ˆë‹¤. ë‰´ìš•ì€ ë™ë¶€ í‘œì¤€ì‹œ(EST) ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, UTC ì‹œê°„ë³´ë‹¤ 5ì‹œê°„ ëŠ¦ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë‰´ìš•ì˜ í˜„ì¬ ì‹œê°„ì€ 2025ë…„ 1ì›” 6ì¼ 14ì‹œ 9ë¶„ 24ì´ˆì…ë‹ˆë‹¤.
```

- í•˜ì§€ë§Œ í˜„ì¬ ê¸°ì¤€(2026-01-26)ìœ¼ë¡œëŠ” LLMì´ ì‚¬ìš©ìì˜ ìœ„ì¹˜ë¥¼ ì•Œê³ , ì´ì— ëŒ€ë¹„í•´ ë‰´ìš• ì‹œê°„ì„ ê³„ì‚°í•œë‹¤.  

```bash
ì‚¬ìš©ì   : ì§€ê¸ˆ ë‰´ìš•ì€ ëª‡ ì‹œì•¼?
2026-01-26 12:48:34
AI      :í˜„ì¬ í•œêµ­ ì‹œê°„ì€ 2026ë…„ 1ì›” 26ì¼ ì˜¤í›„ 12ì‹œ 48ë¶„ì…ë‹ˆë‹¤. ë‰´ìš•ì€ ë™ë¶€ í‘œì¤€ì‹œ(EST)ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°, í•œêµ­ê³¼ ë‰´ìš•ì˜ ì‹œì°¨ëŠ” ì¼ë°˜ì ìœ¼ë¡œ 14ì‹œê°„ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë‰´ìš•ì˜ í˜„ì¬ ì‹œê°„ì€ 1ì›” 26ì¼ ì˜¤ì „ 12ì‹œ 48ë¶„ì¼ ê²ƒì…ë‹ˆë‹¤.
```

- í•˜ì§€ë§Œ í‹€ë ¸ë‹¤. í•œêµ­ê³¼ ë‰´ìš•ì˜ ì‹œì°¨ê¹Œì§€ëŠ” ë§ì·„ì§€ë§Œ  
- ê³„ì‚°ì´ í‹€ë ¸ë‹¤. 14ì‹œê°„ ì°¨ì´ë©´ 1ì›” 25ì¼ ë°¤ 10ì‹œ 48ë¶„ìœ¼ë¡œ ë‹µë³€í•´ì•¼ í•˜ëŠ”ë°, 26ì¼ ì˜¤ì „ 12ì‹œ 48ë¶„ ì¦‰, 12ì‹œê°„ì°¨ë¡œ ê³„ì‚°í•´ì„œ ì˜¤ë‹µì„ ëƒˆë‹¤.  
- ì´ëŸ¬ë‚˜ ì €ëŸ¬ë‚˜ ì„¸ê³„ì‹œê°ì„ ì•Œ ìˆ˜ ìˆê²Œ ë¬¸ë§¥ì„ ì œê³µí•´ì•¼ í•œë‹¤.  

![alt text](assets/images/newyork_time.png)  

- ë„ì‹œë³„ ì‹œê°„ì„ ì•Œë ¤ì£¼ê¸° ìœ„í•´ `pytz` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.  
- ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” íƒ€ì„ì¡´ ë¬¸ìì—´ì„ ë°›ì•„ ê·¸ì— í•´ë‹¹í•˜ëŠ” íƒ€ì„ì¡´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.  
- ì´ë¥¼ datetime.now() ì— ë„£ìœ¼ë©´ í•´ë‹¹ íƒ€ì„ì¡´ì˜ ì‹œê°ì„ êµ¬í•  ìˆ˜ ìˆë‹¤.  
- ì´ë¥¼ ìœ„í•´ ì¼ì „ì— ì‘ì„±í–ˆë˜ gpt_function.py íŒŒì¼ì„ ìˆ˜ì •í•œë‹¤.  

```python
def get_current_time(timezone="Asia/Seoul"): # timezone ë³€ìˆ˜(str)ë¥¼ ë°›ìŒ
    tz = pytz.timezone(timezone) # íƒ€ì„ì¡´ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    now = datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S") # íƒ€ì„ì¡´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¸ìë¡œ ë„£ì–´ now íšë“
    now_timezone = f"{now} {timezone}"
    print(now_timezone)
    return now_timezone

tools = [
    {
        "type": "function",
        "function": {
            "name": "get_current_time",
            "description": "í•´ë‹¹ íƒ€ì„ì¡´ì˜ ë‚ ì§œì™€ ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.",
            "parameters": {
                "type":"object",
                "properties":{
                    "timezone": {
                        "type":"string",
                        "description":"í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì„ ë°˜í™˜í•  íƒ€ì„ì¡´ì„ ì…ë ¥í•˜ì„¸ìš”.(ì˜ˆ. Aisa/Seoul)",
                    }
                },
                "required":["timezone"]
            }
        }
    },
]
```

[pytz - https://whdrns2013.github.io/python/20260126_001_pytz](https://whdrns2013.github.io/python/20260126_001_pytz)


- ê·¸ë¦¬ê³  ì´ì— ë§ì¶° terminal ì½”ë“œë„ ë³€ê²½í•´ì¤€ë‹¤,  

```python
# what_time_is_it_terminal.py
from tools.gpt_functions import get_current_time, tools
from openai import OpenAI
from config.config import config
import json

client = OpenAI(api_key = config["apikey"]["openai"])

# chat gptë¡œë¶€í„° ì‘ë‹µì„ ë°›ì•„ì˜¤ëŠ” ê¸°ë³¸ì ì¸ í‹€
def get_ai_response(messages, tools=None):
    response = client.chat.completions.create(
        model = "gpt-4o",
        messages = messages,
        tools = tools
    )
    return response

# ê¸°ë³¸ ì´ˆê¸° ë©”ì‹œì§€ ì…‹
messages = [
    {"role" : "system", "content" : "ë„ˆëŠ” ì‚¬ìš©ìë¥¼ ë„ì™€ì£¼ëŠ” ìƒë‹´ì‚¬ì•¼."},
]

# í„°ë¯¸ë„ ëŒ€í™” ì„¹ì…˜
def terminal_conversation():
    while True:
        # ì‚¬ìš©ì ì…ë ¥ ë°œí™”
        user_input = input("ì‚¬ìš©ì\t:")
        if user_input == "exit":
            break
        
        # ë©”ì‹œì§€ ì…‹ì— ì‚¬ìš©ì ë°œí™” ì…ë ¥
        messages.append({"role":"user", "content":user_input})
        
        # chat gptì—ê±° ë‹µë³€ ë°›ì•„ì˜´
        ai_response = get_ai_response(messages=messages,
                                    tools=tools)
        ai_message = ai_response.choices[0].message
        
        # tool_calls
        tool_calls = ai_message.tool_calls
        if tool_calls:
            # ë„êµ¬ ì •ë³´ ì¶”ì¶œ
            tool_name = tool_calls[0].function.name
            tool_call_id = tool_calls[0].id
            
            arguments = json.loads(tool_calls[0].function.arguments) # ----- (1) tool call ì—ì„œ ì£¼ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì•„ì„œ
            
            # ë„êµ¬ë§ˆë‹¤ ì‚¬ìš© í•¨ìˆ˜ ë§¤ì¹­í•´ì„œ ë„êµ¬ì˜ ê²°ê³¼ë¥¼ ë©”ì‹œì§€ë¡œ ìƒì„±
            if tool_name == "get_current_time":
                messages.append(
                    {
                        "role" : "function",
                        "tool_call_id" : tool_call_id,
                        "name" : tool_name,
                        "content" : get_current_time(timezone=arguments["timezone"]), # ---- (2) functionì˜ íŒŒë¼ë¯¸í„°ë¡œ ë„£ìŒ
                    }
                )
            # í•œë²ˆ ë” gpt ì‘ë‹µ í˜¸ì¶œ, ì´ë²ˆì—” ë„êµ¬ì˜ ê²°ê³¼ì™€ ë„êµ¬ í˜¸ì¶œ idë¥¼ í¬í•¨í•¨
            ai_response = get_ai_response(messages, tools=tools)
            ai_message = ai_response.choices[0].message
            
        messages.append(ai_message)
        print("AI\t:" + ai_message.content)
```

- ëŒ€í™”ë¥¼ ì§„í–‰í•´ë³´ë©´  

```bash
ì‚¬ìš©ì  :ì§€ê¸ˆ ëª‡ì‹œì•¼?
AI      :ì–´ëŠ ë‚˜ë¼ë‚˜ ì§€ì—­ì˜ ì‹œê°„ì„ ì•Œê³  ì‹¶ìœ¼ì‹ ê°€ìš”? ì˜ˆë¥¼ ë“¤ì–´ "Asia/Seoul"ê³¼ ê°™ì€ í˜•íƒœë¡œ ë§ì”€í•´ ì£¼ì„¸ìš”.
ì‚¬ìš©ì  :ì„œìš¸
AI      :ì§€ê¸ˆ ì„œìš¸ì˜ ì‹œê°„ì€ 2026ë…„ 1ì›” 27ì¼ ì˜¤í›„ 9ì‹œ 37ë¶„ì…ë‹ˆë‹¤.
ì‚¬ìš©ì  :ë¯¸ë‰´ë‰´ìš•ì€?
AI      :ë‰´ìš•ì˜ ì‹œê°„ì€ 2026ë…„ 1ì›” 27ì¼ ì˜¤ì „ 7ì‹œ 38ë¶„ì…ë‹ˆë‹¤.
```

#### ì—¬ëŸ¬ ë„ì‹œì˜ ì‹œê°„ ì•Œë ¤ì£¼ê¸°  

- ìœ„ê¹Œì§€ êµ¬ì¶•í•œ ê²ƒì— ì—¬ëŸ¬ ë„ì‹œ ë¬¼ì–´ë³´ê¸°  

```bash
ì‚¬ìš©ì  :ì„œìš¸, ë„ì¿„, ë‰´ìš•ì˜ ì‹œê°„ì€ ëª‡ì‹œì•¼?
Traceback (most recent call last):
    print("AI\t:" + ai_message.content)
          ~~~~~~~~^~~~~~~~~~~~~~~~~~~~
TypeError: can only concatenate str (not "NoneType") to str
```

- ë§ˆì§€ë§‰ AI ì˜ ë‹µë³€ì„ ëœ¯ì–´ë³´ë‹ˆ  

```bash
# ì²« function call ì€ ì˜ ë“¤ì–´ì˜´ (ì„œìš¸)
Function(arguments='{"timezone": "Asia/Seoul"}', name='get_current_time')

# function call ì„ í•œ ë’¤, ë‹µë³€ì„ í•˜ëŠ” ê²Œ ì•„ë‹Œ "ë‹¤ìŒ ì‹œê°„ëŒ€ ì§€ì—­ ì‹œê°„ í‘ì…˜ì½œ"ì„ í•¨
# ê·¸ëŸ¬ë‹ˆ ì—¬ê¸°ì„œ ë‹µë³€ì„ ì°¾ì„ ìˆ˜ê°€ ì—†ì§€..
ChatCompletionMessage(content=None,...
   function=Function(arguments='{"timezone": "Asia/Seoul"}', name='get_current_time'), type='function'...
   function=Function(arguments='{"timezone": "Asia/Tokyo"}', name='get_current_time'), type='function'...
   function=Function(arguments='{"timezone": "America/New_York"}', name='get_current_time'),...
```

- ì—¬ëŸ¬ í•¨ìˆ˜ê°€ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œë  ìˆ˜ ìˆë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •  

```python
# what_time_is_it_terminal.py
from tools.gpt_functions import get_current_time, tools
from openai import OpenAI
from config.config import config
import json

client = OpenAI(api_key = config["apikey"]["openai"])

# chat gptë¡œë¶€í„° ì‘ë‹µì„ ë°›ì•„ì˜¤ëŠ” ê¸°ë³¸ì ì¸ í‹€
def get_ai_response(messages, tools=None):
    response = client.chat.completions.create(
        model = "gpt-4o",
        messages = messages,
        tools = tools
    )
    return response

# ê¸°ë³¸ ì´ˆê¸° ë©”ì‹œì§€ ì…‹
messages = [
    {"role" : "system", "content" : "ë„ˆëŠ” ì‚¬ìš©ìë¥¼ ë„ì™€ì£¼ëŠ” ìƒë‹´ì‚¬ì•¼."},
]

# í„°ë¯¸ë„ ëŒ€í™” ì„¹ì…˜
def terminal_conversation():
    while True:
        # ì‚¬ìš©ì ì…ë ¥ ë°œí™”
        user_input = input("ì‚¬ìš©ì\t:")
        if user_input == "exit":
            break
        
        # ë©”ì‹œì§€ ì…‹ì— ì‚¬ìš©ì ë°œí™” ì…ë ¥
        messages.append({"role":"user", "content":user_input})
        
        # chat gptì—ê±° ë‹µë³€ ë°›ì•„ì˜´
        ai_response = get_ai_response(messages=messages,
                                    tools=tools)
        ai_message = ai_response.choices[0].message
        
        # tool_calls
        tool_calls = ai_message.tool_calls
        if tool_calls:
            for tool_call in tool_calls: # ---- (1) tool call ë§ˆë‹¤ ë°˜ë³µ
                # ë„êµ¬ ì •ë³´ ì¶”ì¶œ
                tool_name = tool_call.function.name
                tool_call_id = tool_call.id
                
                print(tool_call.function)
                arguments = json.loads(tool_call.function.arguments) 
                
                # ë„êµ¬ë§ˆë‹¤ ì‚¬ìš© í•¨ìˆ˜ ë§¤ì¹­í•´ì„œ ë„êµ¬ì˜ ê²°ê³¼ë¥¼ ë©”ì‹œì§€ë¡œ ìƒì„±
                if tool_name == "get_current_time":
                    messages.append(
                        {
                            "role" : "function",
                            "tool_call_id" : tool_call_id,
                            "name" : tool_name,
                            "content" : get_current_time(timezone=arguments["timezone"]), 
                        }
                    )
            
            messages.append({"role":"system", "content":"ì´ì œ ì£¼ì–´ì§„ ê²°ê³¼ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•˜ì‹œì˜¤"}) # ------ (2) tool call ì´ ëë‚¬ìœ¼ë‹ˆ, ë‹µë³€í•˜ë„ë¡ í•¨        
            # í•œë²ˆ ë” gpt ì‘ë‹µ í˜¸ì¶œ, ì´ë²ˆì—” ë„êµ¬ì˜ ê²°ê³¼ì™€ ë„êµ¬ í˜¸ì¶œ idë¥¼ í¬í•¨í•¨
            ai_response = get_ai_response(messages, tools=tools)
            ai_message = ai_response.choices[0].message
        print(ai_message)
        messages.append(ai_message)
        print("AI\t:" + ai_message.content)
```

- ì§ˆë‹µì„ í•´ë³´ë©´  

```bash
ì‚¬ìš©ì  :ì„œìš¸, ë„ì¿„, ë‰´ìš•ì˜ ì‹œê°„ì€  ëª‡ ì‹œì•¼?
AI      :í˜„ì¬ ì‹œê°ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- ì„œìš¸: 2026ë…„ 1ì›” 27ì¼ 22ì‹œ 7ë¶„ 14ì´ˆ
- ë„ì¿„: 2026ë…„ 1ì›” 27ì¼ 22ì‹œ 7ë¶„ 14ì´ˆ
- ë‰´ìš•: 2026ë…„ 1ì›” 27ì¼ 8ì‹œ 7ë¶„ 14ì´ˆ

ë„ì¿„ì™€ ì„œìš¸ì€ ê°™ì€ ì‹œì°¨ì´ë©°, ë‰´ìš•ì€ 14ì‹œê°„ ëŠ¦ìŠµë‹ˆë‹¤.
```

#### ìŠ¤íŠ¸ë¦¼ë¦¿ì— ì ìš©  

```python
#openai_api.py
from openai import OpenAI
from config.config import config
from schemas.dto import OpenAIMessage
import json
from tools.gpt_functions import tools, tool_mapping

def get_ai_response(messages:list[dict],
                    model:str,
                    temperature:float,
                    tools=None):
    api_key = config["apikey"]["openai"]
    client = OpenAI(api_key = api_key)
    response = client.chat.completions.create(
        model = model,
        temperature = temperature,
        messages = messages,
        tools = tools
    )
    return response

def chat_gpt(user_message:str|None=None,
             system_message:str|None=None,
             assistant_message:str|None=None,
             messages:list[OpenAIMessage]|list[dict]|None=None,
             model:str="gpt-4o",
             temperature:float=0.1,
             tools=tools):
    
    # ë©”ì‹œì§€ ì œì‘
    if messages:
        for i, message in enumerate(messages):
            if isinstance(message, OpenAIMessage):
                messages[i] = message.__dict__
    else:
        messages = []
        if system_message:
            messages.append({"role":"system", "content":system_message})
        if user_message:
            messages.append({"role":"user", "content":user_message})
        if assistant_message:
            messages.append({"role":"assistant", "content":assistant_message})
    
    # AI ì‘ë‹µ ë°˜í™˜
    response = get_ai_response(messages=messages,
                               model=model,
                               temperature=temperature,
                               tools=tools)
    
    # function calling ì²˜ë¦¬
    if response.choices[0].message.tool_calls:
        tool_calls = response.choices[0].message.tool_calls
        for tool_call in tool_calls:
            # LLM ì‘ë‹µì—ì„œ ë„êµ¬ ì •ë³´ ì¶”ì¶œ
            tool_name = tool_call.function.name
            tool_call_id = tool_call.id
            arguments = json.loads(tool_call.function.arguments) 
            
            # ë„êµ¬ë§ˆë‹¤ ì‚¬ìš© í•¨ìˆ˜ ë§¤ì¹­í•´ì„œ ë„êµ¬ì˜ ê²°ê³¼ë¥¼ ë©”ì‹œì§€ë¡œ ìƒì„±
            messages = tool_mapping(messages = messages,
                                    tool_name = tool_name,
                                    tool_call_id = tool_call_id,
                                    arguments = arguments)
        
        # í•œë²ˆ ë” gpt ì‘ë‹µ í˜¸ì¶œ, ì´ë²ˆì—” ë„êµ¬ì˜ ê²°ê³¼ì™€ ë„êµ¬ í˜¸ì¶œ idë¥¼ í¬í•¨í•¨
        messages.append({"role":"system", "content":"ì´ì œ ì£¼ì–´ì§„ ê²°ê³¼ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•˜ì‹œì˜¤"})
        response = get_ai_response(messages, model=model, temperature=temperature, tools=tools)
        
    return response

# ê²°ê³¼ í…ìŠ¤íŠ¸ ì¶œë ¥
# response.choices[0].message.content

# TODO: ìŠ¤íŠ¸ë¦¬ë° ì ìš©
```

```python
# gpt_functions.py
# gpt_function.py
from datetime import datetime
import pytz

def get_current_time(timezone="Asia/Seoul"):
    tz = pytz.timezone(timezone)
    now = datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
    now_timezone = f"{now} {timezone}"
    print(now_timezone)
    return now_timezone

tools = [
    {
        "type": "function",
        "function": {
            "name": "get_current_time",
            "description": "í•´ë‹¹ íƒ€ì„ì¡´ì˜ ë‚ ì§œì™€ ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.",
            "parameters": {
                "type":"object",
                "properties":{
                    "timezone": {
                        "type":"string",
                        "description":"í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì„ ë°˜í™˜í•  íƒ€ì„ì¡´ì„ ì…ë ¥í•˜ì„¸ìš”.(ì˜ˆ. Aisa/Seoul)",
                    }
                },
                "required":["timezone"]
            }
        }
    },
]

def tool_mapping(messages:list[dict],
                 tool_name:str,
                 tool_call_id:str|int,
                 arguments:dict|None):
    if tool_name == "get_current_time":
        messages.append(
            {
                "role" : "function",
                "tool_call_id" : tool_call_id,
                "name" : tool_name,
                "content" : get_current_time(timezone=arguments["timezone"]), 
            }
        )
    return messages
```

```python
# streamlit_chat.py
import streamlit as st
from core.openai_api import chat_gpt

def streamlit_chat(chat_function=chat_gpt):
    
    # ì‚¬ì´ë“œë°” : 
    with st.sidebar:
        "Streamlit í…ŒìŠ¤íŠ¸"
    
    # title
    st.title("ğŸ¤– Doit Chatbot")
    
    # ì´ˆê¸° ë©”ì‹œì§€
    if "messages" not in st.session_state: # st.session_state : ìŠ¤íŠ¸ë¦¼ë¦¿ì—ì„œ ì‚¬ìš©ìì˜ ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬
                                           # ì‚¬ìš©ìê°€ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ìƒí˜¸ì‘ìš©í•˜ëŠ” ë™ì•ˆ ìƒíƒœê°€ ì €ì¥/ìœ ì§€ë˜ê³  ì—…ë°ì´íŠ¸ ë¨
        st.session_state.messages = [{"role": "assistant", "content": "ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"}] # ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ì´ˆê¸° ë©”ì‹œì§€ ë³´ì—¬ì¤Œ
    
    # ëŒ€í™” ê¸°ë¡ì„ ì›¹ë¸Œë¼ìš°ì €ì— ì¶œë ¥
    for message in st.session_state.messages:
        with st.chat_message(message["role"]): # st.chat_message : ìŠ¤íŠ¸ë¦¼ë¦¿ì˜ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ì— ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ëŠ” ìš©ë„ (assistant / user)
            st.markdown(message["content"])    # st.markdown : ì»¨í…ì¸ ë¥¼ ì¶œë ¥í•  í˜•íƒœ ì§€ì • - ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ (ê¸°ë³¸ì€ write)
    
    # LLM ì— ì§ˆì˜
    if prompt := st.chat_input(): # ì‚¬ìš©ìì˜ ì…ë ¥ì„ ë°›ì•„ prompt ë³€ìˆ˜ì— í• ë‹¹
        st.session_state.messages.append({"role": "user", "content": prompt}) # ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ìƒíƒœ - ë©”ì„¸ì§€ì— ì¶”ê°€
        with st.chat_message("user"): # ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ í™”ë©´ì˜ "chat message container"ë¡œ ë³´ì—¬ì¤Œ
            st.markdown(prompt)
        # ì§ˆì˜ì— ëŒ€í•œ ì‘ë‹µ ë°›ì•„ì˜´
        response = chat_function(messages = st.session_state.messages)
        msg = response.choices[0].message.content
        # ì‘ë‹µì„ ì„¸ì…˜ì— ì—…ë°ì´íŠ¸
        st.session_state.messages.append({"role":"assistant", "content":msg})
        # í™”ë©´ì— ì‘ë‹µ ì¶œë ¥
        with st.chat_message("assistant"):
            st.markdown(msg)
    
    # TODO: ìŠ¤íŠ¸ë¦¬ë° ì ìš©
    

# streamlit ì‹¤í–‰
```

```python
# main.py
from service.what_time_is_it_terminal import terminal_conversation
from core.streamlit_chat import streamlit_chat
from core.openai_api import chat_gpt

def main():
    streamlit_chat()


if __name__ == "__main__":
    main()
```

![alt text](image.png) 

- í˜„ì¬ í™”ë©´ì—ì„œëŠ” ì‹œìŠ¤í…œ ë©”ì‹œì§€ì™€ í•¨ìˆ˜ ì‹¤í–‰ ê²°ê³¼ê°€ í™”ë©´ì—ì„œ ê°™ì´ ë…¸ì¶œëœë‹¤.  
- ì´ê²ƒì„ ë°©ì§€í•˜ë ¤ë©´ ë©”ì‹œì§€ì˜ role ì´ userë‚˜ assistant ì¸ ê²½ìš°ë§Œ ì¶œë ¥í•˜ê²Œ í•˜ë©´ ëœë‹¤.  

```python
# ê¸°ì¡´
for message in st.session_state.messages:
    with st.chat_message(message["role"]): # st.chat_message : ìŠ¤íŠ¸ë¦¼ë¦¿ì˜ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ì— ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ëŠ” ìš©ë„ (assistant / user)
        st.markdown(message["content"])    # st.markdown : ì»¨í…ì¸ ë¥¼ ì¶œë ¥í•  í˜•íƒœ ì§€ì • - ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ (ê¸°ë³¸ì€ write)

# ìˆ˜ì •
for message in st.session_state.messages:
    if (message["role"] == "user") or (message["role"] == "assistant"):
        with st.chat_message(message["role"]): # st.chat_message : ìŠ¤íŠ¸ë¦¼ë¦¿ì˜ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ì— ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ëŠ” ìš©ë„ (assistant / user)
            st.markdown(message["content"])    # st.markdown : ì»¨í…ì¸ ë¥¼ ì¶œë ¥í•  í˜•íƒœ ì§€ì • - ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ (ê¸°ë³¸ì€ write)
```

![alt text](image.png)